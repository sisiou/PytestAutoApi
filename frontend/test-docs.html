<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文档列表测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>已上传文档列表测试</h2>
        
        <div class="mt-4">
            <button class="btn btn-primary" id="loadDocsBtn">
                <i class="fas fa-refresh me-2"></i>加载文档列表
            </button>
        </div>
        
        <div class="mt-4">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>文档名称</th>
                        <th>API数量</th>
                        <th>上传时间</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="documentsTableBody">
                    <!-- 文档列表将通过JavaScript动态生成 -->
                </tbody>
            </table>
            
            <div id="noDocumentsMessage" class="alert alert-info" style="display: none;">
                没有已上传的文档
            </div>
        </div>
        
        <div class="mt-4">
            <h3>API响应</h3>
            <pre id="apiResponse" class="bg-light p-3 rounded"></pre>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- API配置 -->
    <script src="js/config/api-config.js"></script>
    
    <script>
        // 加载文档列表
        function loadDocuments() {
            console.log('开始加载文档列表');
            
            fetch(API_CONFIG.BASE_URL + API_CONFIG.ENDPOINTS.DOCS.OPENAPI_LIST)
                .then(response => response.json())
                .then(data => {
                    console.log('获取文档列表响应:', data);
                    
                    // 显示API响应
                    document.getElementById('apiResponse').textContent = JSON.stringify(data, null, 2);
                    
                    if (data.success) {
                        const documents = data.data || [];
                        console.log('文档列表:', documents);
                        
                        const tableBody = document.getElementById('documentsTableBody');
                        const noDocsMessage = document.getElementById('noDocumentsMessage');
                        
                        // 清空现有内容
                        tableBody.innerHTML = '';
                        
                        if (documents.length === 0) {
                            // 显示无文档消息
                            noDocsMessage.style.display = 'block';
                            console.log('没有已上传的文档');
                        } else {
                            // 隐藏无文档消息
                            noDocsMessage.style.display = 'none';
                            
                            // 添加文档到表格
                            documents.forEach(doc => {
                                const row = document.createElement('tr');
                                
                                // 文档名称
                                const nameCell = document.createElement('td');
                                nameCell.textContent = doc.file_name || '未知文件';
                                row.appendChild(nameCell);
                                
                                // API数量
                                const apiCountCell = document.createElement('td');
                                apiCountCell.textContent = doc.api_count || 0;
                                row.appendChild(apiCountCell);
                                
                                // 上传时间
                                const uploadTimeCell = document.createElement('td');
                                const uploadDate = new Date(doc.upload_time);
                                uploadTimeCell.textContent = uploadDate.toLocaleString();
                                row.appendChild(uploadTimeCell);
                                
                                // 状态
                                const statusCell = document.createElement('td');
                                const statusBadge = document.createElement('span');
                                statusBadge.className = 'badge bg-success';
                                statusBadge.textContent = '已上传';
                                statusCell.appendChild(statusBadge);
                                row.appendChild(statusCell);
                                
                                // 操作
                                const actionsCell = document.createElement('td');
                                const viewBtn = document.createElement('button');
                                viewBtn.className = 'btn btn-sm btn-outline-primary me-1';
                                viewBtn.innerHTML = '<i class="fas fa-eye"></i> 查看';
                                viewBtn.addEventListener('click', () => viewDocument(doc.file_id));
                                
                                const deleteBtn = document.createElement('button');
                                deleteBtn.className = 'btn btn-sm btn-outline-danger';
                                deleteBtn.innerHTML = '<i class="fas fa-trash"></i> 删除';
                                deleteBtn.addEventListener('click', () => deleteDocument(doc.file_id));
                                
                                actionsCell.appendChild(viewBtn);
                                actionsCell.appendChild(deleteBtn);
                                row.appendChild(actionsCell);
                                
                                tableBody.appendChild(row);
                            });
                            
                            console.log(`已加载 ${documents.length} 个文档`);
                        }
                    } else {
                        console.error('获取文档列表失败:', data.message);
                        alert('获取文档列表失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('加载文档列表出错:', error);
                    alert('加载文档列表出错: ' + error.message);
                });
        }
        
        // 查看文档详情
        function viewDocument(docId) {
            console.log('查看文档详情:', docId);
            alert('查看文档详情功能: ' + docId);
        }
        
        // 删除文档
        function deleteDocument(docId) {
            console.log('删除文档:', docId);
            
            if (!confirm('确定要删除这个文档吗？此操作不可撤销。')) {
                return;
            }
            
            alert('删除文档功能: ' + docId);
        }
        
        // 页面加载完成后自动加载文档列表
        document.addEventListener('DOMContentLoaded', function() {
            // 加载按钮点击事件
            document.getElementById('loadDocsBtn').addEventListener('click', loadDocuments);
            
            // 自动加载文档列表
            loadDocuments();
        });
    </script>
</body>
</html>