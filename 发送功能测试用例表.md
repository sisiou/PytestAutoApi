# 飞书"发送消息"接口自动化测试用例表

## 一、权限与认证校验阶段

| 用例ID      | 用例名称        | 前置条件                               | 操作步骤                                                     | 预期结果                      |
| :---------- | :-------------- | :------------------------------------- | :----------------------------------------------------------- | :---------------------------- |
| TC_AUTH_001 | Token无效或过期 | 1. 使用无效或过期的tenant_access_token | 1. 构造请求头：Authorization="Bearer 无效token" 2. 构造正常请求体 3. 发送POST请求 | HTTP 401，错误码提示token无效 |

  暂不考虑：

1. 应用未启用机器人能力
2. 应用缺少im:message权限

## 二、参数边界校验阶段

| 用例ID       | 用例名称              | 前置条件        | 操作步骤                                                     | 预期结果               |
| :----------- | :-------------------- | :-------------- | :----------------------------------------------------------- | :--------------------- |
| TC_PARAM_001 | receive_id缺失        | 1. 具有发送权限 | 1. 构造请求体：缺少receive_id字段 2. 其他字段正常 3. 发送POST请求 | HTTP 400，错误码230001 |
| TC_PARAM_002 | receive_id为空字符串  | 1. 具有发送权限 | 1. 构造请求体：receive_id="" 2. 其他字段正常 3. 发送POST请求 | HTTP 400，错误码230001 |
| TC_PARAM_003 | receive_id_type值非法 | 1. 具有发送权限 | 1. 设置receive_id_type="invalid_type" 2. 构造正常请求体 3. 发送POST请求 | HTTP 400，错误码230001 |
| TC_PARAM_004 | msg_type值非法        | 1. 具有发送权限 | 1. 构造请求体：msg_type="invalid_type" 2. 其他字段正常 3. 发送POST请求 | HTTP 400，错误码230001 |
| TC_PARAM_005 | content非JSON格式     | 1. 具有发送权限 | 1. 构造请求体：content="not_a_json_string" 2. 其他字段正常 3. 发送POST请求 | HTTP 400，错误码230001 |

## 三、接收者状态校验

| 用例ID          | 用例名称     | 前置条件                      | 操作步骤                                                     | 预期结果                                  |
| :-------------- | :----------- | :---------------------------- | :----------------------------------------------------------- | :---------------------------------------- |
| TC_RECEIVER_002 | 用户id不存在 | 1. 具有发送权限 2. 用户已离职 | 1. 设置receive_id_type="user_id" 2. 构造请求体：receive_id=已离职用户ID 3. 发送POST请求 | 返回错误码230029，提示"User has resigned" |

## 四、消息内容与类型校验

| 用例ID         | 用例名称                   | 前置条件                                                     | 操作步骤                                                     | 预期结果                                   |
| :------------- | :------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------------- |
| TC_CONTENT_001 | 文本消息-正常内容          | 1. 具有发送权限 2. 有效接收者                                | 1. 设置msg_type="text" 2. 构造content='{"text":"测试消息"}' 3. 发送POST请求 | HTTP 200，消息发送成功                     |
| TC_CONTENT_002 | 文本消息内容超长（边界值） | 1. 具有发送权限                                              | 1. 设置msg_type="text" 2. 构造content，text字段超过150KB 3. 发送POST请求 | 返回错误码230025，提示"消息体长度超出限制" |
| TC_CONTENT_003 | 卡片消息-正常内容          | 1. 具有发送权限 2. 有效接收者 3. 准备有效的卡片JSON          | 1. 设置msg_type="interactive" 2. 构造content='{"elements":[{"tag":"markdown","content":"这是一个测试卡片消息"}]}' 3. 发送POST请求 | HTTP 200，卡片消息发送成功                 |
| TC_CONTENT_004 | 图片消息-正常内容          | 1. 具有发送权限 2. 有效接收者 3. 已上传图片并获取有效的image_key | 1. 设置msg_type="image" 2. 构造content='{"image_key":"有效图片key"}' 3. 发送POST请求 | HTTP 200，图片消息发送成功                 |
| TC_CONTENT_003 | 卡片消息内容超长（边界值） | 1. 具有发送权限                                              | 1. 设置msg_type="interactive" 2. 构造卡片content超过30KB 3. 发送POST请求 | 返回错误码230025，提示"消息体长度超出限制" |
| TC_CONTENT_004 | 消息类型与内容不匹配       | 1. 具有发送权限                                              | 1. 设置msg_type="text" 2. 构造content='{"image_key":"xxx"}' 3. 发送POST请求 | HTTP 400，错误码提示类型不匹配             |

暂不考虑:

1、发送敏感信息

## 五、去重机制

| 用例ID       | 用例名称                         | 前置条件        | 操作步骤                                                     | 预期结果                            |
| :----------- | :------------------------------- | :-------------- | :----------------------------------------------------------- | :---------------------------------- |
| TC_LIMIT_001 | 消息去重-相同UUID在重复发送      | 1. 具有发送权限 | 1. 第一次发送：uuid="test-uuid-001" 2. 立即第二次发送：相同uuid和内容 | 1. 第一次成功 2. 第二次失败或未发送 |
| TC_LIMIT_002 | UUID长度超过50字符限制（边界值） | 1. 具有发送权限 | 1. 构造请求体：uuid为51个字符 2. 发送POST请求                | HTTP 400，错误码230001              |

暂不考虑

1、UUID 超过一个小时是否会过期

## 六、组合覆盖用例

| 用例ID         | 用例名称                       | 前置条件                       | 操作步骤                                                     | 预期结果       |
| :------------- | :----------------------------- | :----------------------------- | :----------------------------------------------------------- | :------------- |
| TC_COMBINE_001 | 组合1：user_id+文本消息+无uuid | 1. 具有发送权限 2. 有效user_id | 1. receive_id_type="user_id" 2. msg_type="text" 3. content='{"text":"测试"}' 4. 不设置uuid 5. 发送POST请求 | HTTP 200，成功 |



## 
